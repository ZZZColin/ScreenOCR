System.register(["./chunk.vendor-legacy.BJJjiZ1D.js","./index-legacy.Du2TpUsX.js","./chunk.antd-vendor-legacy.CAwSLbVj.js"],(function(e,t){"use strict";var s,r,n,i,a,o,l,c,d,u,h,f,p,m,x,g,N;return{setters:[e=>{s=e.ac,r=e.ad,n=e.ae,i=e.a5,a=e.q,o=e.r,l=e.af,c=e.ag,d=e.R},e=>{u=e.A,h=e.R,f=e.D,p=e.C},e=>{m=e.L,x=e.T,g=e.S,N=e.B}],execute:function(){class t{dependencies;values;formulas;reverseDeps;_sortedNodes=null;constructor(){this.dependencies={},this.reverseDeps={},this.values={},this.formulas={}}getAllNodes(){return Object.keys(this.dependencies)}addNode(e,t=[],s=null){if(this.dependencies[e])throw new Error(`Node ${e} already exists.`);this.dependencies[e]=t,this.formulas[e]=s,this.values[e]=null,this.reverseDeps[e]=this.reverseDeps[e]||[];for(const r of t)this.reverseDeps[r]=this.reverseDeps[r]||[],this.reverseDeps[r].includes(e)||this.reverseDeps[r].push(e)}topologicalSort(){if(null!==this._sortedNodes)return this._sortedNodes;const e=[],t=new Set,s=r=>{t.has(r)||(t.add(r),(this.dependencies[r]||[]).forEach(s),e.push(r))};return Object.keys(this.dependencies).forEach(s),this._sortedNodes=e,e}computeAll(e){(e?this.topologicalSort().filter((t=>e.includes(t))):this.topologicalSort()).forEach((e=>{this.formulas[e]&&(this.values[e]=this.formulas[e](e))}))}getAffectedNodes(e){const t=new Set,s=[e];for(;s.length>0;){const e=s.shift();for(const r of this.reverseDeps[e]||[])t.has(r)||(t.add(r),s.push(r))}return Array.from(t)}updateValue(e,t){this.values[e]=t;const s=this.getAffectedNodes(e);if(0===s.length)return;const r=this.topologicalSort().filter((e=>s.includes(e)));for(const n of r)this.formulas[n]&&(this.values[n]=this.formulas[n](n))}getValues(){return this.values}hasCycle(){const e=new Set,t=new Set,s=r=>{if(t.has(r))return!0;if(e.has(r))return!1;t.add(r);for(const e of this.dependencies[r]||[])if(s(e))return!0;return t.delete(r),e.add(r),!1};for(const r of Object.keys(this.dependencies))if(s(r))return!0;return!1}}class b{graph;constructor(){this.graph=new t}build(){if(this.graph.hasCycle())throw new Error("Cycle detected in dependency graph");return this.graph}}function y(e){return e.replaceAll("​","")}function j(e){return"string"==typeof e&&e.startsWith("​")}function E(e){return j(e)||function(e){return"string"==typeof e&&e.endsWith("​")}(e)}function v(){return VBA_EE["Section: Data from Worklog"]?.Carrier??"Unknown Carrier"}const D=VBA_IFN,A=VBA_EE,M=VBA_OFN,w=VBA_UI,O=VBA_Alert,T=VBA_FORMULA_IFN,C=VBA_FORMULA_OFN,k=VBA_FORMULA_ALERT,I=VBA_FORMULA_HIDDEN_SECTIONS,S=VBA_GENERATE_JSON,F=(new class extends b{constructor(){super()}fromJSON(){for(const[e,t]of Object.entries(M)){const s=this.buildDependsOnFromOFN(e,t),r=this.buildDependsOnFromAlert(e,O[e]);this.graph.addNode(e,Array.from(new Set([...s,...r])),C.bind(null,e,M,this.graph.getValues()))}for(const[e,t]of Object.entries(D)){const s=this.buildDependsOnFromIFN(e,t),r=this.buildDependsOnFromAlert(e,O[e]);this.graph.addNode(e,Array.from(new Set([...s,...r])),T.bind(null,e,D,A,this.graph.getValues()))}return this}buildDependsOnFromIFN(e,t){const s=[],r=t.Filter;return Object.keys(r).length&&Object.keys(r).filter((e=>!!r[e]?.length)).forEach((e=>{const t=r[e];s.push(e),t.forEach((e=>{j(e)&&s.push(y(e))}))})),s}buildDependsOnFromOFN(e,t){const s=[],r=t["Source Key in IFN"];r in D&&s.push(r);const n=t.Mapping;if(Array.isArray(n)&&n.length)for(const a of n)a.forEach((e=>{let t=e;E(t)&&(t=y(t),-1===s.indexOf(t)&&s.push(t))}));const i=t.Calculation;if(Array.isArray(i)&&i.length)for(const a of i)a.forEach((e=>{let t=e;E(t)&&(t=y(t),-1===s.indexOf(t)&&s.push(t))}));return s}buildDependsOnFromAlert(e,t){if(!t)return[];const s=[],r=t.Mapping[0];if(Array.isArray(r)&&r.length)for(const i of r)i.forEach((t=>{let r=t;E(r)&&(r=y(r),-1===s.indexOf(r)&&e!==r&&s.push(r))}));const n=t.Calculation[0];if(Array.isArray(n)&&n.length)for(const i of n)i.forEach((t=>{let r=t;E(r)&&(r=y(r),-1===s.indexOf(r)&&e!==r&&s.push(r))}));return s}formula(){}}).fromJSON().build();console.log(F,"dependencyGraph");var L=(e=>(e.TEXT="text",e.EMAIL="email",e.NUMBER="number",e.DATE="date",e.SELECT="select",e.RADIO="radio",e.CHECKBOX="checkbox",e.COMPOSE="compose",e))(L||{}),R=(e=>(e.INPUT="input",e.OUTPUT="output",e))(R||{}),B=(e=>(e.ALERT="ALERT",e.REMINDER="REMINDER",e))(B||{});const U=e=>t=>t?"number"===e?Number(t):"date"===e?"Invalid Date"!==new Date(t).toString()?s(t).format("YYYY-MM-DD"):null:t:t,V=e=>e.split("$$")[1],z=(e,t)=>Object.keys(e[t]?.types||{}).reduce(((s,r)=>{const n=(e[t]?.types||{})[r].split(";").map((e=>{const[t,s]=e.split(":");return{type:t,content:s}}));return s.concat(n)}),[]);function _({field:e}){if(!F.getAllNodes().includes(e.name))throw new Error(`Field name is not a valid key: ${e.name||e.label}`)}function P({field:e}){if(!e.type)throw new Error(`Field type is missing: ${e.name}`)}function Y({field:e}){e.id=[r(),e.name].join("$$")}const Q=(e,t)=>{const s=F.getValues();return(t=t||Object.keys(s)).reduce(((t,r)=>{const n=e[r].registeredNames,i=U(e[r].type)(s[r]);return n.forEach((e=>{t[e]=i})),t}),{})},K=e=>{const t=(s=e.rules,"[object Object]"===Object.prototype.toString.call(s)?e.rules:{});var s;return"function"==typeof t.validate?{...t,validate:t.validate(e.name,k,O,F.getValues())}:t},H=(e,t,s,r,n,o,l,c)=>{const d="h-8 w-full rounded-[4px] placeholder:text-[#747881]  border-1  px-2 text-sm font-medium  border-[#E1E6EA] focus:outline-none",u="function"==typeof e.options?e.options():e.options??[],h=e.placeholder??"Please select",p=!!e.readonly,m={"border-[#FB4671] focus:border-[#FB4671]":c,"bg-white":c&&o,"border-[#E1E6EA] focus:border-[#E1E6EA]":!c&&o,"border-[#dddfe1] focus:border-[#dddfe1]":!c&&l},x=p?"cursor-auto":"cursor-pointer";switch(e.type){case L.TEXT:case L.EMAIL:case L.NUMBER:return i.jsx("input",{disabled:p,className:a(d,x,m),type:e.type,placeholder:e.placeholder,...t(e.id,n),onChange:t=>{r(e.id,t.target.value)}});case L.DATE:return i.jsxs("div",{className:"relative w-full",children:[i.jsx("input",{disabled:p,className:a(d,x,m,"[&::-webkit-calendar-picker-indicator]:opacity-0",{"text-[#747881]":!s[e.id]}),type:e.type,placeholder:e.placeholder,...t(e.id,n),onChange:t=>{r(e.id,t.target.value)},onClick:e=>{e.currentTarget.showPicker()}}),i.jsx("button",{type:"button",onClick:e=>{e.currentTarget.previousElementSibling.showPicker()},className:a("absolute inset-y-0 right-0 flex items-center pr-3",x),children:i.jsx(f,{width:14,height:14})})]});case L.CHECKBOX:return i.jsx("input",{disabled:p,className:a("h-4 w-4",x,{}),type:e.type,...t(e.id,n),onChange:t=>{r(e.id,t.target.checked)}});case L.RADIO:return i.jsx("div",{className:"flex gap-2",children:u.map((a=>i.jsxs("div",{className:"mr-4 flex items-center",children:[i.jsx("input",{disabled:p,className:"mr-2 h-4 w-4",id:e.id+a.value,type:e.type,value:a.value,checked:s[e.id]===a.value,...t(e.id,n),onChange:t=>{r(e.id,t.target.value)}}),i.jsx("label",{className:"base-sm cursor-pointer font-medium text-[#0B0B0B]",htmlFor:e.id+a.value,children:a.label})]},e.id+a.value)))});case L.SELECT:return i.jsxs("select",{disabled:p,className:a(d,x,"appearance-none bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTYuNTA1NTkgOS4xMDU0QzYuNzc4OTEgOS40MDkxIDcuMjIyNzkgOS40MDkxIDcuNDk2MTEgOS4xMDU0TDEwLjI5NDkgNS45OTU1QzEwLjQ5NjEgNS43NzE5OCAxMC41NTUyIDUuNDM5MTIgMTAuNDQ1OCA1LjE0NzU3QzEwLjMzNjUgNC44NTYwMSAxMC4wODI4IDQuNjY2NSA5Ljc5ODU5IDQuNjY2NUw0LjIwMDkzIDQuNjY4OTNDMy45MTg4NiA0LjY2ODkzIDMuNjYzMDIgNC44NTg0NCAzLjU1MzcgNS4xNUMzLjQ0NDM3IDUuNDQxNTUgMy41MDU1OSA1Ljc3NDQgMy43MDQ1NyA1Ljk5NzkzTDYuNTAzNCA5LjEwNzgyTDYuNTA1NTkgOS4xMDU0WiIgZmlsbD0iIzAyMUY2MSIvPgo8L3N2Zz4K')] bg-[right_0.5rem_center] bg-no-repeat pr-6",m),...t(e.id,n),onChange:t=>{r(e.id,t.target.value)},children:[i.jsx("option",{disabled:!0,value:h,children:h}),(e.options??[]).map((t=>i.jsx("option",{value:t.value,children:t.label},e.id+t.value)))]});default:return null}},W=({field:e,onChange:t,type:s,isHovered:r,onMouseEnter:o,onMouseLeave:l})=>{const{register:c,getValues:d,formState:{errors:f}}=n(),p=K(e),m=z(f,e.id),x=m.some((e=>e.type===B.ALERT)),g=!x&&r,N=s===R.INPUT,b=s===R.OUTPUT,y="flex w-[34%] max-w-52 text-base font-medium text-wrap";return i.jsxs("div",{onMouseEnter:o,onMouseLeave:l,className:a("mx-8 flex h-full w-full flex-col items-center px-8 py-3",{"bg-[#FB46711A]":x,"bg-[#f0f4fc]":g&&N,"bg-[#e4eaf5]":g&&b}),children:[i.jsxs("div",{className:a("flex h-full w-full items-center gap-2",{"text-[#021F61]":b,"text-[#0B0B0B]":N}),children:[i.jsx("label",{className:a(y),children:i.jsxs("div",{className:a("relative flex h-full items-center pr-3 break-all"),children:[e.label,p.required&&i.jsx("span",{className:"absolute top-1/2 right-0 mt-1 -translate-y-1/2 transform text-[18px] font-bold text-red-500",children:"*"})]})}),i.jsx("div",{className:"flex-1",children:i.jsx("div",{className:"flex items-center",style:{maxWidth:(e.width??200)+"px"},children:H(e,c,d(),t,p,N,b,x)})})]}),i.jsxs("div",{className:"flex w-full gap-2",children:[i.jsx("div",{className:a(y)}),i.jsx("div",{className:"flex-1",children:m.map(((t,s)=>i.jsxs("div",{className:"mt-0.5 flex text-sm font-medium",children:[i.jsx("div",{className:"mt-1 mr-[6px]",children:t.type===B.ALERT?i.jsx(u,{width:12,height:12}):i.jsx(h,{width:12,height:12})}),i.jsx("div",{className:a("flex-1",{"text-[#FB4671]":t.type===B.ALERT,"text-[#497EDC]":t.type===B.REMINDER}),children:t.content})]},e.id+s)))})]})]})},Z=({inputField:e,outputField:t,isLastRow:s,isFirstRow:r,index:n,onChange:l})=>{const[c,d]=o.useState(null),u=e=>{d(e)},h=()=>{d(null)};return i.jsxs("div",{className:a("flex justify-between gap-6",{}),children:[i.jsx("div",{className:a("flex flex-1 border-x-2 border-[#497EDC] bg-white",{"rounded-b-[6px] border-b-2 border-[#497EDC] pb-2":s,"pt-2":r}),children:e&&i.jsx(W,{onMouseEnter:()=>{u(n)},onMouseLeave:h,isHovered:c===n,type:R.INPUT,onChange:l,field:e},e.id)}),i.jsx("div",{className:a("flex flex-1 border-x-2 border-[#021F613D] bg-[#f4f5f8]",{"rounded-b-[6px] border-b-2 border-[#021F613D] pb-2":s,"pt-2":r}),children:t&&i.jsx(W,{onMouseEnter:()=>{u(n)},onMouseLeave:h,isHovered:c===n,type:R.OUTPUT,onChange:l,field:t},t.id)})]})},$=v(),J=({section:e,onChange:t})=>{const[s,r]=o.useState(!1),n=e.fields[0].length;return i.jsxs("div",{className:"p-4",children:[i.jsxs("div",{onClick:()=>r(!s),className:"flex cursor-pointer items-center justify-between",children:[i.jsxs("h2",{className:"flex items-center text-xl font-bold select-none",children:[i.jsx("span",{className:"mr-4 inline-block h-5 w-[5px] rounded-[999px] bg-[linear-gradient(90deg,#7EBD31,#00BBC2)]"}),e.sectionName]}),i.jsx("div",{className:a({"rotate-180":s}),children:i.jsx(p,{})})]}),i.jsxs("div",{className:a("mt-4 gap-4",{hidden:s}),children:[i.jsxs("div",{className:"flex justify-between gap-6",children:[i.jsx("div",{className:"flex-1 rounded-t-[6px] bg-[#497EDC] py-2 text-center text-sm font-bold text-white",children:"EN/Worklog/Email"}),i.jsx("div",{className:"flex-1 rounded-t-[6px] bg-[#021F613D] py-2 text-center text-sm font-bold text-[#021F61]",children:$})]}),e.fields[0].map(((s,r)=>{const a=e.fields[0][r],o=e.fields[1][r],l=e.sectionName+(a?.id??o?.id);return i.jsx(Z,{inputField:a,outputField:o,onChange:t,isLastRow:r===n-1,isFirstRow:0===r,index:r},l)}))]})]})},G=o.memo((({sections:e,fieldKeyMap:t,formRef:s,initialValues:r})=>{const n=Object.keys(t);console.log("re-render1111",e);const a=l({criteriaMode:"all",defaultValues:r}),{formState:{errors:d}}=a;o.useImperativeHandle(s,(()=>({validateFields:async()=>{if(!(await a.trigger())){const e=(e=>Object.keys(e).reduce(((t,s)=>(e[s]&&(t[s]=z(e,s)),t)),{}))(d),t=Object.keys(e).reduce(((t,s)=>{const r=V(s);t[r]??=[];const n=e[s].filter((e=>e.type===B.REMINDER)).map((e=>e.content));return t[r]=t[r].concat(n),t}),{});return{hasErrors:Object.keys(e).some((t=>e[t].filter((e=>e.type===B.ALERT)).length>0)),reminderMessages:t}}return{hasErrors:!1,reminderMessages:{}}}})));const u=(e,s)=>{console.log("change name",e,s);const r=V(e);var i;F.updateValue(r,(i=t[r].type,e=>{if(!e)return e;if("number"===i)return Number(e);if("date"===i){const t=new Date(e),s=t.getTimezoneOffset();return new Date(t.getTime()+6e4*s)}return e})(s));const o=F.getValues();F.getAffectedNodes(r).filter((e=>n.includes(e))).concat(r).forEach((e=>{t[e].registeredNames.forEach((s=>{a.setValue(s,U(t[e].type)(o[e]),{shouldValidate:!0})}))}))};return o.useEffect((()=>{setTimeout(a.trigger,0)}),[r]),i.jsx(c,{...a,children:i.jsx("form",{children:e.map((e=>i.jsx("div",{className:"mb-5 rounded-[5px] bg-white",children:i.jsx(J,{section:e,onChange:u})},e.sectionName)))})})}),((e,t)=>!1===t.isActive));F.computeAll();const X=F.getValues(),q=w,{fieldKeyMap:ee}=function(e,t){const s={};return e.forEach((e=>{const r={};e.sections.forEach((s=>{s.fields.forEach((n=>{n.forEach((n=>{n&&(Array.isArray(t)&&t.forEach((t=>{t({field:n,section:s,tab:e})})),n.id=n.id??n.name,r[n.name]??={type:n.type,registeredNames:[],actionIDs:[]},r[n.name].registeredNames.push(n.id),n.actionID&&r[n.name].actionIDs.push(n.actionID))}))}))})),s[e.tabName]=r})),{fieldKeyMap:s}}(q,[_,P,Y]),te=I(X);console.log(ee,"fieldKeyMap");let se=!1;const re=()=>{const[e,t]=o.useState(0),s=o.useRef(q.map((()=>d.createRef()))),r=q[e].tabName,n=q.map(((t,r)=>{const n=t.sections.filter((e=>!te.includes(e.sectionName)));return{key:t.tabName,label:t.tabName,children:i.jsx("div",{className:"overflow-y-auto",style:{height:"calc(100vh - 200px)"},children:i.jsx(G,{fieldKeyMap:ee[t.tabName],sections:n,formRef:s.current[r],isActive:e===r,initialValues:Q(ee[t.tabName],Object.keys(ee[t.tabName]))})})}}));return i.jsxs("div",{children:[i.jsx(m.Content,{children:i.jsx(x,{renderTabBar:e=>{const{activeKey:t,onTabClick:s}=e;return i.jsx("div",{className:"mb-4 select-none",children:i.jsx("div",{className:"inline-flex rounded-[100px] border-1 border-[#E1E6EA]",children:n.map((e=>i.jsx("div",{className:a("cursor-pointer rounded-[100px] px-4 py-2 text-base font-bold text-nowrap text-[#0B0B0B]",{"bg-transparent":t!==e.key,"bg-[#021F61] text-white":t===e.key}),onClick:t=>s(e.key,t),children:e.label},e.key)))})})},activeKey:r,onChange:e=>{const s=n.findIndex((t=>t.key===e));t(-1===s?0:s)},items:n,destroyInactiveTabPane:!1})}),i.jsx(m.Footer,{className:"flex w-full items-center justify-end px-0 py-2",children:i.jsxs(g,{size:16,children:[i.jsx(N,{onClick:()=>{if(se)return;se=!0;const e=function(){const e=VBA_EE["Section: Data from Worklog"];return{filename:e["Naming String"]??`${v()}`,needPastingToClipboard:e["Paste to Clipboard"],fileMimeType:e["Exported MIME Type"],exportSuccessMessage:e["Export Success Notice"],exportFailMessage:e["Export Fail Notice"],validateFailMessage:e["Validate Fail Notice"]}}();s.current.every((e=>!!e.current))?Promise.all(s.current.map((e=>e.current.validateFields()))).then((async s=>{const r=e=>e.hasErrors;if(!s.every((e=>!r(e))))return t(s.findIndex(r)),alert(e.validateFailMessage);const n=S(((e,t)=>Object.keys(e).reduce(((s,r)=>(Object.keys(e[r]).forEach((n=>{e[r][n].actionIDs.forEach((e=>{const r=void 0===t[n]?null:t[n];s[e]=String(r)}))})),s)),{}))(ee,X),s.reduce(((e,t)=>(Object.keys(t.reminderMessages).forEach((s=>{e[s]??=[],e[s]=e[s].concat(t.reminderMessages[s].filter((t=>!e[s].includes(t))))})),e)),{}));!function(e,t,s){const r=JSON.stringify(e,null,2),n=new Blob([r],{type:t}),i=document.createElement("a");i.href=URL.createObjectURL(n),i.download=s,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(i.href)}(n,e.fileMimeType,e.filename),e.needPastingToClipboard&&await async function(e){try{await navigator.clipboard.writeText(e),console.log("Text copied to clipboard")}catch(t){console.error("Failed to copy text to clipboard:",t)}}(JSON.stringify(n,null,2)),alert(e.exportSuccessMessage)})).catch((()=>{alert(e.exportFailMessage)})).finally((()=>{se=!1})):(se=!1,alert(e.validateFailMessage),t(s.current.findIndex((e=>!e.current))))},className:"h-10 rounded-[4px] bg-[#497EDC] text-base leading-6 font-bold text-white",children:"Submit"}),i.jsx(N,{className:"h-10 rounded-[4px] bg-[#497EDC] text-base leading-6 font-bold text-white",onClick:()=>{e<n.length-1&&t(e+1)},children:"Next"})]})})]})};e("default",(()=>i.jsx(re,{})))}}}));
